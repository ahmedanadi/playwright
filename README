# Playwright E2E Tests ğŸ¯

A small, focused Playwright + TypeScript test project for the Conduit web app. This README shows how to set up, run, and debug tests locally and in CI.

---

## Prerequisites âš™ï¸

- âœ… Node.js 20 / 22 / 24
- ğŸ”§ Git
- ğŸš€ A running frontend (web) and API backend. By default the project expects:
	- ğŸŒ Web UI: `BASE_URL` (see `env-config.yaml`, default: `http://localhost:3000`)
	- ğŸ› ï¸ API: `API_BASE_URL` (see `env-config.yaml`, default: `http://127.0.0.1:8000`)

Tip: On macOS `localhost` may resolve to IPv6 (::1). If you see connection issues, try `http://127.0.0.1:3000`.

## Install ğŸ§°

```bash
npm install
# (optional) install Playwright browsers and system deps
npx playwright install --with-deps
```

## Handy npm scripts ğŸ“¦

- `npm test` â€” â–¶ï¸ run Playwright tests (headless)
- `npm run test:headed` â€” ğŸ–¥ï¸ run tests with browser UI (helpful for debugging)
- `npm run test:report` â€” ğŸ“Š open the HTML report generated by Playwright

These were added to `package.json` to simplify running tests.

## Editor integration â€” VS Code ğŸ§‘â€ğŸ’»

We recommend installing the Playwright extension for Visual Studio Code to make authoring, running and debugging tests much easier.

- Recommended extension: `Playwright` (Visual Studio Marketplace)
- Benefits:
	- ğŸ›ï¸ Run tests and see results inline
	- ğŸ§­ Debug tests using the built-in VS Code debugger
	- ğŸ§¾ Generate test code with Playwright Codegen
	- ğŸ§° Handy snippets and Test Runner UI

Install (VS Code):

```bash
code --install-extension ms-playwright.playwright
```

Or search for "Playwright" in the Extensions view in VS Code and install the official extension.

## Running tests â–¶ï¸

- Run all tests (headless):

```bash
npm test
```

- Run a single file:

```bash
npx playwright test tests/articleComments.spec.ts
```

- Run a single test by name:

```bash
npx playwright test -g "user can add a comment to an article"
```

## Configuration âš™ï¸

- Environment-specific values live in `env-config.yaml`. The Playwright config (`playwright.config.ts`) loads this file and exports env values to `process.env` for the tests.
- Key env values:
	- ğŸŒ `BASE_URL` â€” web UI base address
	- ğŸ”— `API_BASE_URL` â€” API base address used by API helpers/fixtures

If your app listens on a different host/port, update `env-config.yaml` or pass overrides via CLI/env vars.

## Fixtures & helpers ğŸ§©

- `tests/api/apiHelpers.ts` â€” centralized helpers used to create users and articles via the API (fast setup).
- `tests/fixtures/test-fixtures.ts` â€” exposes `creds` (creates unique user) and `authTest` (auto-injects auth token via `page.addInitScript`). Prefer `authTest` for tests that require a logged-in user.

## Docker ğŸ³

Use Playwright's official Docker image to validate Linux compatibility and avoid OS dependency issues:

```bash
docker run --rm -it \
    --network=host \
    -v "$(pwd)":/work -w /work \
    -e BASE_URL="http://127.0.0.1:4200" \
    -e API_BASE_URL="http://127.0.0.1:8000" \
    mcr.microsoft.com/playwright:focal \
    /bin/bash -lc "npm ci && npx playwright install --with-deps && npx playwright test"
```

Notes:
- On macOS use `host.docker.internal` so the container can reach services running on the host.
- On a Linux host you can use `--network=host` for direct host access.

## CI example (GitHub Actions) âœ…

Add a workflow at `.github/workflows/playwright.yml` (example in this repo recommendations) to run tests on `ubuntu-latest`. Use `npx playwright install --with-deps` to ensure browsers and OS libs are present.

## Troubleshooting âš ï¸

- âŒ ERR_CONNECTION_REFUSED when navigating: verify the frontend `BASE_URL` is reachable and correct. Try `curl -I $BASE_URL`.
- ğŸ§¾ Case-sensitivity errors on CI: ensure file import casing matches filenames exactly (Linux is case-sensitive).
- ğŸ Flaky deletes / eventual consistency: run headed (`npm run test:headed`) for debugging and inspect the HTML report in `playwright-report/`.

## Extras / next steps â•

- â• Optionally add a `pretest` script to perform a quick preflight check (verifies `BASE_URL` and `API_BASE_URL` are reachable) â€” I can add this.
- ğŸ” Optionally add a `token` fixture that returns the auth token directly to speed tests that use the token frequently.

---

If you'd like, I can: add the GitHub Actions workflow, the preflight script, or a polished Dockerfile. Which would you like next?
